<div class="m-5" style="min-height: 350px;">
    <div class="d-flex  flex-row-reverse">
        <button onclick="show_addmodal()" id="id-drug-add" class="rounded-5 btn btn-outline-success btn-sm"><i
                class="fa fa-plus-circle"></i> Formulation</button>
        <div class="form-generic me-5 d-flex flex-row">
            <input type="text" placeholder="Search" class="form-control bg-success bg-opacity-10 form-control-sm text-center border-0 rounded">
            <button onclick="senderbender()" type="submit" class=" btn bg-success bg-opacity-25 btn-sm rounded-3"><i
                    class="fas fa-search"></i> </button>
        </div>
        <span class="text-lg-start me-5 text-success " id="the_delivery_guy">
        <%=msg%>
    </span>
    </div>
    <table  class="w-100 mt-3 rounded-3">
        <thead>
            <tr class="bg-success bg-opacity-25 rounded">
                <th scope="col">#</th>
                <th scope="col">Formulation Name</th>
                <th scope="col">Update</th>
                <th scope="col">Delete</th>
            </tr>
        </thead>
        <tbody>
            <% for (let i=0;i<formulations.length;i++) { %>
                <tr style="height: 30px; " class="border border-bottom-1 ">
                    <th scope="row" style="  ">
                        <%=i+1%>
                    </th>
                    <td style="  ">
                        <%=formulations[i].name %>
                    </td>
                    <td style="  ">
                        <button onclick="show_editmodal(`<%=formulations[i].name %>`,`<%=formulations[i].id %>`)" class="btn btn-outline-info btn-sm" style="font-size: 11px; ">
                            <i class="fas fa-pen "></i></button>
                    </td>
                    <td style="  ">
                        <button onclick="show_dltmodal(`<%=formulations[i].name %>`,`<%=formulations[i].id %>`)" class="btn btn-outline-danger btn-sm" style="font-size: 11px; "> <i
                                class="fas fa-trash "></i></button>
                    </td>
                </tr>
                <% } %>
        </tbody>
    </table>
    <div id="dlt-modal" class="modal mt-5 rounded ">
        <div class="modal-dialog " role="document ">
            <div class="modal-content bg-secondary">
                <div class="modal-body py-4 rounded-3">
                    <form action="/formulations/dlt" method="DELETE">
                        <input type="hidden" id="dlt_frm_pagenumb" name="pagenumb" value=<%=skip / limit + 1%> >
                        <input hidden type="text" id="dlt_frmid" value="" name="frmid" />
                         <span class="shadow-sm badge bg-light bg-opacity-75 text-dark d-block mb-4 pb-1 text-center">Sure About
                            Deletion ? </span>
                        <button type="submit" class=" mb-3 btn btn-sm btn-danger w-25 rounded ">Delete</button>
                    </form>
                    <button onclick="document.getElementById('dlt-modal').style.display='none'" class=" btn btn-sm btn-outline-dark w-25 rounded "> Cancel </button>
                </div>
            </div>
        </div>
    </div>
    <div id="edt-modal" class="modal mt-5 rounded ">
        <div class="modal-dialog " role="document ">
            <div class="modal-content ">
                <div class="modal-header ">
                    <h5 class="modal-title ">Update Formulation</h5>
                    <button class="btn btn-warning " onclick="document.getElementById( 'edt-modal').style.display='none' ">
                        <i class="fa fa-times-circle " aria-hidden="true "></i>
                    </button>
                </div>
                <div class="modal-body ">
                    <form class="text-start " action="/formulations/edt" method="POST">
                        <input type="hidden" id="edt_frm_pagenumb" name="pagenumb" value=<%=skip / limit + 1%> >
                        <input type="hidden" id="edt_frmid" value=" " name="frmid" />
                        <label for="frmname" class="form-label ">Name:</label>
                        <input id="edt_frmname" type="text " class="form-control " required name="frmname">
                        <button type="submit" class="btn btn-sm btn-info mt-4 mb-3 w-50 rounded ">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div id="add-modal" class="modal mt-5 rounded">
        <div class="modal-dialog " role="document ">
            <div class="modal-content bg-light ">
                <div class="modal-header ">
                    <h5 class="modal-title ">New Formulation</h5>
                    <button class="btn btn-warning " onclick="document.getElementById( 'add-modal').style.display='none' ">
                        <i class="fa fa-times-circle " aria-hidden="true "></i>
                    </button>
                </div>
                <div class="modal-body ">
                    <form class="text-start " action="/formulations" method="POST">
                        <input type="hidden" id="add_frm_pagenumb" name="pagenumb" value=<%=skip / limit + 1%> >
                        <label for="frmname" class="form-label ">Name:</label>
                        <input type="text " class="form-control " required name="frmname" placeholder="ex: Tablet ">
                        <button class="btn btn-sm btn-outline-dark mt-4 w-100 ">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex gap-1 mt-1  " style=" height: 30px;">
        <span class="text-success">
                Go to page
            </span>
            <form id="pagenumbform" action="/formulations" method="put">
                <button onclick="pageDown()" style="width: 26px;height: 30px;" class="btn btn-sm bg-black bg-opacity-10"><strong>-</strong></button>
                <input id="pagenumb" onchange="pageNumbSubmit()" name="pagenumb" type="text" style="width: 30px;height: 30px;" class="border-0 form-control-sm fw-bold" value=<%=skip / limit + 1%> >
                <button onclick="pageUp()" style="width: 26px;" class="btn btn-sm bg-black bg-opacity-10 fw-bold"> + </button>
            </form>
        <span class=" text-black-75 d-block text-start text-capitalize ms-1">(Total <%=Math.ceil(count/limit)%> Pages; <%=count%> Rows)</span>
    </div>

    <script>
        function pageNumbSubmit() {
            if (document.getElementById('pagenumb').value > 0) {
                document.getElementById("pagenumbform").submit();
            }
        }

        function pageUp() {
            document.getElementById('pagenumb').value = Number(document.getElementById('pagenumb').value) + 1
        }

        function pageDown() {
            if (document.getElementById('pagenumb').value > 1) {
                document.getElementById('pagenumb').value = Number(document.getElementById('pagenumb').value) - 1
            }
        }

        let tobeDeleted = {}

        function show_addmodal() {
            document.getElementById('add-modal').style.display = 'block'
        }

        function show_dltmodal(frmName, idFrm) {

            document.getElementById('dlt_frmid').value = idFrm
            document.getElementById('dlt-modal').style.display = 'block'

        }

        function show_editmodal(frmname, idFrm) {

            console.log(idFrm + " in browser console: " + frmname);
            document.getElementById("edt_frmname").value = frmname;
            document.getElementById('edt_frmid').value = idFrm
            document.getElementById('edt-modal').style.display = 'block'

        }

        function senderbender(url, reqMethod, data) {
            data = {
                name: "sender bender "
            }
            fetch("/formulations/pok ", {
                    method: 'post',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-type': 'application/json',
                    }
                }).then(res => res.json())
                .then(json => {
                    console.log(json)
                    select = document.getElementById('senderbender');
                    for (var i = 0; i <= 8; i++) {
                        var opt = document.createElement('option');
                        opt.value = json[i].id;
                        opt.innerHTML = json[i].name;
                        select.appendChild(opt);
                    }
                }).catch(err => {
                    console.log(err)
                })
        }

        setTimeout(() => {
                const idmsg = "the_delivery_guy";
                document.getElementById(idmsg).innerHTML = " "
            }, 3000)
            // Get the modal


        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            let addmodal = document.getElementById('add-modal');
            let edtmodal = document.getElementById('edt-modal')
            let dltmodal = document.getElementById('dlt-modal')
            if (event.target == addmodal) {
                addmodal.style.display = "none ";
            }
            if (event.target == edtmodal) {
                edtmodal.style.display = "none ";
            }
            if (event.target == dltmodal) {
                dltmodal.style.display = "none ";
            }
        }
    </script>
</div>
